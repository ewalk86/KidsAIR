---
title: "KidsAIR: initial exposure analysis"
author: "Ethan Walker"
date: "Started 2 Feb 2020, Updated 2 Feb 2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
library(tidyverse)
library(readxl)
library(naniar)
library(lubridate)
library(zoo)
```

# Load individual datasets
```{r}
pm_clean <- read_rds("Output/pm_clean.rds")
sums_clean <- read_rds("Output/sums_clean.rds")

kids_linked_ids <- read_rds("Output/kids_linked_ids.rds")
demographics_clean <- read_rds("Output/demographics_clean.rds")
moisture_clean <- read_rds("Output/moisture_clean.rds")
indoor_temp_rh_clean <- read_rds("Output/indoor_temp_rh_clean.rds")
stove_use_clean <- read_rds("Output/stove_use_clean.rds")
stove_grades_clean <- read_rds("Output/stove_grades_clean.rds")
home_char_clean <- read_rds("Output/home_char_clean.rds")
home_act_clean <- read_rds("Output/home_act_clean.rds")
```


# Combine datasets
```{r}
pm_home_mean <- pm_clean %>% 
  filter(winter_id == 1 & treatment == "Placebo") %>% 
  #filter(pm < 500) %>% 
  mutate(pm = if_else(pm > 500, 500, pm)) %>% 
  group_by(area, home) %>% 
  summarize(mean_pm = mean(pm, na.rm = TRUE))

pm_demographics <- pm_home_mean %>% 
  left_join(demographics_clean, by = c("area", "home")) %>% 
  filter(winter_id == 1) %>% 
  mutate(income = factor(income,
                         levels = c("Less than $20,000", "$20,000 to $29,999",
                                    "$30,000 to $39,999", "$40,000 to $49,999",
                                    "$50,000 to $74,999", "$75,000 to $99,999",
                                    "$100,000 or more"))) %>% 
  mutate(education = factor(education,
                            levels = c("Less than high school", 
                                       "High school diploma or GED",
                                       "Some college",
                                       "College degree")))


pm_home_char <- pm_home_mean %>% 
  left_join(home_char_clean, by = c("area", "home")) %>% 
  filter(winter_id == 1) %>% 
  mutate(stove_age = factor(stove_age,
                         levels = c("0-5 years old", "6-10 years old",
                                    "11-15 years old", "16 + years old",
                                    "Do not know")))


pm_home_char <- pm_home_mean %>% 
  left_join(home_char_clean, by = c("area", "home")) %>% 
  filter(winter_id == 1) %>% 
  mutate(stove_age = factor(stove_age,
                         levels = c("0-5 years old", "6-10 years old",
                                    "11-15 years old", "16 + years old",
                                    "Do not know")))
```


# Simple associations between PM and covariates
```{r}
pm_demographics_results <- lm(mean_pm ~ education, data = pm_demographics)
summary(pm_demographics_results)


pm_home_char_results <- lm(mean_pm ~ stove_age, data = pm_home_char)
summary(pm_home_char_results)
```


